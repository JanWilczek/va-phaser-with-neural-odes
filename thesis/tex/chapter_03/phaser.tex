\section{Phaser Modeling}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Training Data}
\label{sec:phaser_training_data}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The training data consisted solely of guitar recordings taken from the Fraunhofer IDMT database \cite{Kehling2014}. Some of the recordings were additionally distorted using a software distortion plug-in. The purpose of applying additional distortion is that a distorted signal is rich in harmonics and, thus, makes the effect of phaser application more audible. The underlying assumption was that the network would tend to learn better from these more pronounced parts. Additionally, they should make the evaluation task easier during listening tests. 

The acoustic, electric, and distorted guitars were evenly split among the training, validation, and test sets. The training set was 5 minutes 44 seconds long, the validation set was 1 minute 6 seconds long and the test set was 1 minute 49 seconds long. Audio data was single-channel at \SI{44100}{Hz} sampling rate.

The dataset was synthesized using a digital model of a phaser from \cite{Kiiski2016} with feedback turned off. The purpose of using synthesized data instead of recorded was to provide a ground truth LFO signal in the dataset. This was the approach taken for the initial validation in \cite{Wright2020}. If a recording was used, we would need to estimate the LFO, what could obscure the analysis. The LFO signal used for the synthesis was a rectified sine at \SI{17}{Hz}. Again, since the purpose of the training was to validate if the ODENet architecture could be applied to phaser modeling, only one type and rate of the LFO signal were used. If the answer was positive, more LFO waveforms and frequencies would be used (probably involving some not seen during training at test time). 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Training}
\label{sec:phaser_training}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The training procedure was equal to the one for the diode clipper as described in \Section{sec:diode_clipper_training}. The only difference was that the validation loss was computed every 10 epochs instead of every epoch.

The loss function used for the training and the validation was the mean frame-wise log spectral distance as described by 
%TODO: \Equation{}.
It was chosen because of superior validation performance at high frequencies when used to train the baseline (\ac{LSTM}) in comparison to $L_1$ and $L_2$ distances in the \ac{STFT} domain as well as the \ac{ESR}.

All models were trained and tested on data at \SI{44100}{Hz} sampling rate.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Compared Models}
\label{sec:phaser_models}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In the case of the phaser models, only the ODENet framework was compared to the baseline: an \ac{LSTM} from \cite{Wright2020} with 16 memory cells (\ac{LSTM}16). For the derivative network a sufficiently large \ac{MLP} was chosen. Its dimensionality was $M + 2 \times 30 \times 60 \times 60\times 60 \times 30\times M$, where $M$ was the manually-set size of the state vector. The nonlinearity used was \ac{SELU}. To prevent divergence, we added a weight decay term to the loss function as a regularizer.

\begin{table}[]
    \caption{Compared network architectures for phaser modeling}
    \centering
    \input{tex/chapter_03/phaser_models_data.tex}
    \label{tab:phaser_models_data}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results and Discussion}
\label{sec:phaser_results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The goal of phaser modeling was not only to compare the ODENet to the approach taken in \cite{Wright2020} but also to verify the assumption on the state augmentation. The assumption was that if derivative network can use the unobserved entries in the state vector to store information helpful in obtaining more accurate results.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Impact of the State Augmentation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The effect of augmenting the state vector from 1 to 36 can be seen in \Figure{fig:state_augmentation}. Although no target was provided for the 35 latent entries, the network used them to store meaningful information for each time point. The observed improvement is over two-fold. Therefore, it is beneficial to augment the state, even if no training signal is provided for them.

\begin{figure}
    \centering
    \input{figures/tikz/state_augmentation/state_augmentation.tex}
    \caption{Validation loss of the ODENet with and without state augmentation.}
    \label{fig:state_augmentation}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Comparison to the Baseline}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Test results of phaser modeling are contained in \Table{tab:phaser_results}. The 'Loss' is the \ac{ESR}-based loss from \Equation{eq:final_loss_function}. \ac{segSNR} was defined in \Equation{eq:seg_snr}.

\begin{table}[]
    \caption{Test results of the phaser models.}
    \centering
    \input{tex/chapter_03/phaser_results_table.tex}
    \label{tab:phaser_results}
\end{table}

% TODO: Add validation curves
% TODO: Add spectrograms
